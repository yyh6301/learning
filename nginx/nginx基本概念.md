


本质：一个反向代理服务器，通常用来当作负载均衡的中间件，直接接受用户的请求，再来进行流量转发到实际的服务器上去，实现流量的代理。

## 特点

1. 基于异步非阻塞的epoll来实现事件驱动

2. nginx代理和后端web服务器间无需长连接；

3. 接收用户请求是异步的，即先将用户请求全部接收下来，再一次性发送后后端web服务器，极大的减轻后端web服务器的压力

4. 发送响应报文时，是边接收来自后端web服务器的数据，边发送给客户端的


5. 网络依赖型低。NGINX对网络的依赖程度非常低，理论上讲，只要能够ping通就可以实施负载均衡，而且可以有效区分内网和外网流量

6. 支持服务器检测。NGINX能够根据应用服务器处理页面返回的状态码、超时信息等检测服务器是否出现故障，并及时返回错误的请求重新提交到其它节点上


## 内部模型
![[Pasted image 20240530232308.png]]
nginx的内部时由*一个master进程*和*多个worker进程*组成的，master进程通常用来管理和监控worker进程

- Master进程:主要用来管理worker进程，包含：接收来自外界的信号，向各worker进程发送信号，监控worker进程的运行状态，当worker进程退出后(异常情况下)，会自动重新启动新的worker进程。

- worker进程:基本的网络事件，则是放在worker进程中来处理了。多个worker进程之间是对等的，他们同等竞争来自客户端的请求，各进程互相之间是独立的。一个请求，只可能在一个worker进程中处理。worker进程的个数是可以设置的，一般我们会设置与机器cpu核数一致（更多的worker数，只会导致进程来竞争cpu资源了，从而带来不必要的上下文切换。与cpu核数一样，刚好利用好计算机的资源）



## nginx是如何处理一个请求的

1. nginx在启动时，会解析配置文件，得到需要监听的端口与ip地址，然后在nginx的master进程里面，先初始化好这个监控的socket(创建socket，设置addrreuse等选项，绑定到指定的ip地址端口，再listen)
2. 这个Master会fork(一个现有进程可以调用fork函数创建一个 新进程。由fork创建的新进程被称为子进程 )出多个子进程出来，子进程成为worker，然后子进程会竞争accept新的连接。
3. 客户端向nginx发起连接了。当客户端与nginx进行三次握手，与nginx建立好一个连接后
4. 某一个子进程会accept成功，得到这个建立好的连接的 socket，然后创建nginx对连接的封装，即ngx_connection_t结构体。
5. 设置读写事件处理函数并添加读写事件来与客户端进行数据的交换。
6. nginx或客户端来主动关掉连接。